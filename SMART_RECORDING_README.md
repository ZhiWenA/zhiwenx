# 智能操作录制功能使用说明

## 功能概述

智问X的智能操作录制功能是一个全新设计的无障碍服务，能够：
1. **真实捕获用户操作**：通过Android无障碍服务API实时捕获用户的点击、输入、滑动等操作
2. **智能应用识别**：自动检测应用启动和切换，构建完整的操作流程
3. **精确操作回放**：支持跨设备的操作回放，确保操作的准确性
4. **安全隐私保护**：智能排除敏感应用和系统操作，保护用户隐私

## 主要特性

### 1. 智能无障碍服务
- **真实事件捕获**：基于Android AccessibilityService，捕获真实的用户交互事件
- **多类型操作支持**：
  - 应用启动和切换 (app_launch)
  - 点击操作 (click)
  - 长按操作 (long_click)
  - 文本输入 (input)
  - 滚动操作 (scroll)
  - 滑动手势 (swipe)
- **智能过滤**：自动排除系统应用和本应用的操作，避免录制干扰

### 2. 高级录制控制
- **悬浮窗控制**：提供美观的原生悬浮窗，支持拖拽和实时状态显示
- **暂停/继续**：支持录制过程中的暂停和继续
- **实时监控**：显示已录制操作数量和当前状态
- **安全模式**：可选择是否排除自身应用操作

### 3. 智能数据结构
- **元数据丰富**：每个操作包含详细的上下文信息
  - 包名和Activity名称
  - 控件信息（类名、文本、资源ID、边界等）
  - 时间戳和相对时间
  - 操作描述和元数据
- **设备信息**：记录设备型号、屏幕尺寸等兼容性信息
- **会话管理**：支持会话开始/结束标记，便于管理录制流程

### 4. 跨设备兼容
- **设备适配**：记录设备信息，支持不同设备间的适配
- **坐标转换**：支持基于控件信息的智能坐标转换
- **兼容性检查**：回放前检查设备兼容性

## 使用流程

### 1. 权限设置
1. 点击"开启服务"按钮
2. 在无障碍设置中找到"智问X智能录制服务"
3. 开启该服务并授予权限
4. 如需使用悬浮窗，还需要授予悬浮窗权限

### 2. 开始录制
1. 确保智能录制服务已开启
2. 点击"开始录制"按钮或使用悬浮窗
3. **重要**：建议录制前先回到目标应用的主页
4. 进行需要录制的操作序列
5. 服务会自动捕获：
   - 应用启动和切换
   - 点击、长按操作
   - 文本输入
   - 滚动和滑动

### 3. 录制控制
- **暂停/继续**：可随时暂停录制，不会影响已录制的操作
- **实时监控**：查看已录制操作数量和最近操作列表
- **停止录制**：自动保存录制文件

### 4. 保存和管理
- **自动保存**：停止录制时自动保存为带时间戳的文件
- **手动保存**：可自定义文件名进行保存
- **文件管理**：在录制文件列表中查看所有已保存的录制

### 5. 回放录制
1. 从下拉列表中选择要回放的录制文件
2. 点击"执行录制"按钮
3. 系统会按照录制时的时间间隔和顺序重现操作：
   - 自动启动目标应用
   - 执行点击、输入等操作
   - 显示执行进度
4. 回放完成后显示执行结果

## 技术实现

### Android无障碍服务 (SmartAccessibilityService)
- **事件监听**：监听用户交互事件
- **手势执行**：使用GestureDescription API执行手势
- **应用控制**：启动和切换应用
- **数据存储**：JSON格式存储录制数据

### Flutter前端 (SmartRecordingPage)
- **服务状态管理**：检查和控制无障碍服务状态
- **录制控制界面**：提供直观的录制控制界面
- **实时反馈**：显示录制状态和操作历史
- **文件管理**：录制文件的加载和执行

### 数据格式
```json
{
  "version": "1.0",
  "createdAt": 1640995200000,
  "deviceInfo": {
    "model": "Pixel 6",
    "manufacturer": "Google",
    "screenWidth": 1080,
    "screenHeight": 2400
  },
  "actions": [
    {
      "type": "app_launch",
      "timestamp": 0,
      "packageName": "com.example.app",
      "description": "启动应用: Example App"
    },
    {
      "type": "click",
      "timestamp": 1500,
      "packageName": "com.example.app",
      "nodeInfo": {
        "className": "android.widget.Button",
        "text": "登录",
        "bounds": {"left": 100, "top": 200, "right": 300, "bottom": 280}
      },
      "description": "点击: 登录"
    }
  ]
}
```

## 安全和隐私

### 隐私保护措施
1. **本地存储**：所有录制数据仅存储在本地设备
2. **智能过滤**：自动排除系统应用和敏感操作
3. **用户控制**：用户完全控制录制的开始、暂停和停止
4. **数据透明**：用户可查看和删除所有录制数据

### 安全建议
1. **避免敏感信息**：不要录制包含密码、支付等敏感信息的操作
2. **定期清理**：定期删除不需要的录制文件
3. **设备安全**：确保设备本身的安全性
4. **权限管理**：只在需要时开启无障碍服务

## 兼容性和限制

### 系统要求
- Android 7.0 (API 24) 及以上版本
- 无障碍服务权限
- 悬浮窗权限（可选）

### 兼容性说明
- **相同设备型号**：兼容性最佳
- **相似屏幕尺寸**：需要适配调整
- **不同Android版本**：可能需要微调

### 已知限制
1. **系统应用限制**：某些系统应用可能无法录制
2. **权限要求**：需要用户手动授予无障碍权限
3. **性能影响**：长时间录制可能影响设备性能
4. **应用更新**：目标应用更新后可能需要重新录制

## 故障排除

### 常见问题

1. **无障碍设置中只显示"无障碍快捷按钮"而没有开关**
   - 这通常是由于无障碍服务配置问题导致的
   - 解决方案：
     - 完全卸载应用
     - 重新安装最新版本的APK
     - 重启设备
     - 重新进入无障碍设置查找服务
   - 如果问题依然存在，请检查Android版本兼容性

2. **无法开始录制**
   - 检查无障碍服务是否已开启
   - 确认应用有必要的权限
   - 查看应用是否显示"智能录制服务已连接"

3. **录制不准确**
   - 确保录制前回到应用主页
   - 避免在录制过程中切换应用
   - 检查是否排除了自身应用操作

4. **回放失败**
   - 检查目标应用是否已安装
   - 确认设备兼容性
   - 查看错误日志

5. **权限问题**
   - 重新授予无障碍权限
   - 检查悬浮窗权限设置
   - 确保应用没有被系统杀死

### 无障碍服务设置详细步骤

1. **找到正确的服务**：
   - 打开设置 > 无障碍功能 > 无障碍
   - 查找"智问X - 智能操作录制服务"
   - 如果没有找到，请重新安装应用

2. **开启服务**：
   - 点击进入服务设置页面
   - 找到服务开关（不是快捷按钮）
   - 打开开关
   - 在弹出的警告对话框中点击"确定"

3. **验证服务状态**：
   - 返回智问X应用
   - 查看服务状态是否显示"已开启"
   - 如果显示"智能录制服务已连接"则表示成功

### Android版本兼容性

- **Android 7.0-8.1**：完全支持
- **Android 9.0-10.0**：需要额外权限确认
- **Android 11.0+**：可能需要手动添加到白名单

### 性能优化建议

- 录制时长不要超过5分钟
- 定期清理录制文件
- 避免在低电量时进行录制
- 录制复杂操作时可以分段进行

### 联系支持
如遇到技术问题，请：
1. 查看应用日志
2. 记录操作步骤
3. 提供设备信息和Android版本

## 更新日志

### v1.0 (当前版本)
- 基础智能录制功能
- 无障碍服务集成
- 悬浮窗控制
- 跨设备回放支持
- 安全隐私保护

### 未来计划
- 云端同步功能
- 批量执行录制
- 录制编辑功能
- 更多手势支持
- AI智能优化

这个智能操作录制功能为用户提供了一个强大、安全、易用的自动化工具，可以大大提高重复操作的效率，同时确保用户隐私和数据安全。
