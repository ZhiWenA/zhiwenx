# 操作录制功能使用说明

## 功能概述

智问X的操作录制功能允许用户：
1. 使用美观的原生Android悬浮窗来控制录制
2. 录制用户在应用中的各种操作（点击、输入、滚动、滑动等）
3. 保存和管理录制文件
4. 回放已录制的操作序列

## 主要特性

### 1. 原生悬浮窗
- **美观设计**: 圆角背景，半透明效果
- **可拖拽**: 用户可以拖拽悬浮窗到屏幕任意位置
- **实时状态**: 录制状态会实时反映在悬浮窗的颜色和图标上
- **多功能按钮**: 
  - 录制/停止按钮（主要功能）
  - 暂停/继续按钮
  - 关闭按钮

### 2. 操作录制
- **多种操作类型支持**:
  - 点击操作（click）
  - 文本输入（input）
  - 滚动操作（scroll）
  - 滑动手势（swipe）
  - 等待时间（wait）

- **精确时间记录**: 记录每个操作的精确时间戳
- **操作描述**: 每个操作都可以包含描述信息
- **实时计数**: 显示已录制操作的数量

### 3. 文件管理
- **自动保存**: 停止录制时自动保存文件
- **自定义命名**: 支持用户自定义录制文件名称
- **文件列表**: 显示所有已保存的录制文件
- **JSON格式**: 使用JSON格式存储，便于查看和编辑

### 4. 操作回放
- **精确重现**: 按照录制时的时间间隔精确重现操作
- **进度显示**: 显示当前执行进度和操作类型
- **错误处理**: 包含错误处理机制

## 使用流程

### 1. 权限设置
1. 首次使用时，应用会要求悬浮窗权限
2. 点击"申请悬浮窗权限"按钮
3. 在系统设置中开启悬浮窗权限

### 2. 开始录制
1. 点击"显示悬浮窗"按钮
2. 悬浮窗出现后，点击录制按钮（播放图标）
3. 悬浮窗变为红色，表示开始录制
4. 进行需要录制的操作

### 3. 控制录制
- **暂停/继续**: 点击暂停按钮可以暂停录制，再次点击继续
- **停止录制**: 点击录制按钮（此时显示为暂停图标）停止录制
- **实时监控**: 在应用中可以看到实时的录制状态和操作数量

### 4. 保存和管理
1. 录制完成后，系统会自动保存文件
2. 也可以手动点击"保存录制"按钮自定义文件名
3. 在"录制文件"区域可以查看所有保存的录制

### 5. 回放录制
1. 从下拉列表中选择要回放的录制文件
2. 点击"加载录制"按钮加载文件
3. 点击"执行录制"按钮开始回放
4. 系统会按照原来的时间间隔重现所有操作

## 技术实现

### Android原生组件
- **FloatingWindowService**: 悬浮窗服务，负责显示和管理悬浮窗
- **ActionRecordingService**: 操作录制服务，负责录制和回放操作
- **MainActivity**: 主活动，处理Flutter和Android原生之间的通信

### Flutter组件
- **ActionRecordingPage**: 主要的用户界面
- **MethodChannel**: 用于Flutter调用Android原生方法
- **EventChannel**: 用于接收Android原生事件

### 数据格式
录制文件使用JSON格式存储，每个操作包含以下字段：
- `type`: 操作类型
- `timestamp`: 时间戳
- `x`, `y`: 坐标（适用于点击、滑动等）
- `text`: 文本内容（适用于输入操作）
- `scrollDirection`, `scrollDistance`: 滚动方向和距离
- `swipeStartX`, `swipeStartY`, `swipeEndX`, `swipeEndY`: 滑动起止坐标
- `waitDuration`: 等待时间
- `description`: 操作描述

## 注意事项

1. **权限要求**: 需要悬浮窗权限才能显示悬浮窗控制器
2. **系统兼容性**: 适配Android 6.0以上版本的悬浮窗权限机制
3. **性能考虑**: 录制过程中会实时保存操作，建议不要进行过长时间的录制
4. **存储位置**: 录制文件保存在应用的私有目录中
5. **无障碍服务**: 实际的操作执行需要配合无障碍服务实现

## 扩展功能

该框架支持以下扩展：
1. **自定义操作类型**: 可以轻松添加新的操作类型
2. **录制过滤**: 可以添加录制过滤逻辑，只录制特定类型的操作
3. **批量处理**: 可以支持批量执行多个录制文件
4. **云端同步**: 可以扩展支持录制文件的云端同步
5. **操作编辑**: 可以添加录制文件的编辑功能

这个操作录制功能为用户提供了一个强大而灵活的自动化工具，可以大大提高重复操作的效率。
